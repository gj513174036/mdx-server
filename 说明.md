# MDX-Server 项目说明

MDX-Server 是一个基于 Python 的 Web 服务器，为 MDict 词典文件（.mdx 和 .mdd）提供了一个网页查询界面。它允许用户查询单词并查看其定义，同时支持从 .mdd 文件中提取和显示多媒体内容。

## 架构

该项目由以下几个关键组件构成：

-   **Web 服务器 (`mdx_server.py`)**: 一个简单的 WSGI 服务器，负责处理 HTTP 请求，将其路由到相应的处理程序，并返回词典内容。
-   **MDict 查询引擎 (`mdict_query.py`)**: 应用程序的核心，负责读取和解析 .mdx 和 .mdd 文件。它会构建一个 SQLite 索引，以实现对词典条目的快速查询。
-   **MDict 文件读取器 (`readmdict.py`)**: 一个底层库，提供读取和解码 MDict 文件格式的功能，包括处理压缩和加密。
-   **工具脚本 (`file_util.py`, `mdx_util.py`, `lemma.py`)**: 提供文件 I/O 操作、数据处理和词形还原等功能的辅助脚本。

## 功能

-   **MDX/MDD 文件索引**: 服务器会创建一个 SQLite 数据库来索引 .mdx 和 .mdd 文件的内容，从而实现快速高效的查询。
-   **网页界面**: 服务器提供了一个简单的网页界面，用于查询词典。用户可以在 URL 中输入单词来获取其定义。
-   **多媒体内容提取**: 服务器可以从 .mdd 文件中提取并提供多媒体内容，例如图片和音频。

## 执行流程

1.  **初始化**: 服务器启动时，会初始化一个 `mdict_query.py` 中的 `IndexBuilder` 实例。
2.  **文件选择**: 系统会提示用户使用文件对话框选择一个 .mdx 文件。
3.  **索引**: `IndexBuilder` 会为 .mdx 文件及其对应的 .mdd 文件创建一个 SQLite 索引。该索引将关键字映射到文件中的数据块。
4.  **HTTP 服务器**: 服务器在 8000 端口启动一个 WSGI 服务器。
5.  **请求处理**: 当用户访问 `http://localhost:8000/{word}` 时，服务器的 `application` 函数会被调用。
6.  **单词查询**: 服务器在 SQLite 索引中查询该单词，并从 .mdx 文件中检索相应的定义。
7.  **MDD 资源提取**: 如果定义中包含对多媒体内容的引用，服务器会从 .mdd 文件中提取相应的数据。

## MDD 资源提取实现方式

从 .mdd 文件中提取多媒体资源的功能由 `mdict_query.py` 中的 `get_mdd_by_index` 函数处理。其工作原理如下：

1.  **查询**: 服务器在 SQLite 索引中查询请求的资源。
2.  **文件定位**: 服务器跳转到索引中指定的文件位置。
3.  **读取压缩块**: 服务器从 .mdd 文件中读取压缩的数据块。
4.  **解压缩**: 根据词典的版本，使用 zlib 或 LZO 对数据块进行解压缩。
5.  **返回数据**: 将解压缩后的二进制数据返回给客户端。

通过这个过程，服务器能够高效地从 .mdd 文件中提取并提供多媒体内容，而无需将整个文件加载到内存中。
